{"version":3,"sources":["../../src/local/consent-box.js"],"names":["ConsentBox","options","_setUp","container","classList","add","remove","categoriesElem","_firstByClass","selectedCategories","catElem","querySelectorAll","catKey","dataset","category","getAttribute","push","document","getElementById","containerId","forEach","element","addEventListener","_categoryClicked","bind","_setupButtons","event","targetElement","target","srcElement","targetCatKey","descElem","querySelector","innerHTML","categories","description","elem","_toggleSettings","emit","landingClassList","settingsClassList","contains","className","Error","Observable"],"mappings":"oKA2BA,uD,+nDAKqBA,CAAAA,C,+BACjB,YAA0B,OAAdC,CAAc,wDAAJ,EAAI,WACtB,eAEA,EAAKA,OAAL,CAAeA,CAAf,CACA,EAAKC,MAAL,GAJsB,QAKzB,C,sCAEM,CACH,KAAKC,SAAL,CAAeC,SAAf,CAAyBC,GAAzB,CAA6B,WAA7B,CACH,C,qCAEO,CACJ,KAAKF,SAAL,CAAeC,SAAf,CAAyBE,MAAzB,CAAgC,WAAhC,CACH,C,4CAEoB,IACXC,CAAAA,CAAc,CAAG,KAAKC,aAAL,CAAmB,eAAnB,CADN,CAEXC,CAAkB,CAAG,EAFV,CAGjB,IAAK,GAAIC,CAAAA,CAAT,GAAoBH,CAAAA,CAAc,CAACI,gBAAf,CAAgC,iBAAhC,CAApB,CAAwE,CACpE,GAAMC,CAAAA,CAAM,CAAGF,CAAO,CAACG,OAAR,CAAgBC,QAA/B,CACA,GAA6C,MAAzC,GAAAJ,CAAO,CAACK,YAAR,CAAqB,cAArB,CAAJ,CAAqD,CACjDN,CAAkB,CAACO,IAAnB,CAAwBJ,CAAxB,CACH,CACJ,CACD,MAAOH,CAAAA,CACV,C,uCAEQ,YAEL,KAAKN,SAAL,CAAiBc,QAAQ,CAACC,cAAT,CAAwB,KAAKjB,OAAL,CAAakB,WAArC,CAAjB,CAEA,KAAKhB,SAAL,CAAeQ,gBAAf,CAAgC,kDAAhC,EAAkFS,OAAlF,CAA0F,SAACC,CAAD,CAAa,CACnGA,CAAO,CAACC,gBAAR,CAAyB,OAAzB,CAAkC,CAAI,CAACC,gBAAL,CAAsBC,IAAtB,CAA2B,CAA3B,CAAlC,CACH,CAFD,EAGA,KAAKC,aAAL,EACH,C,0DAEgBC,C,CAAO,IACdC,CAAAA,CAAa,CAAGD,CAAK,CAACE,MAAN,EAAgBF,CAAK,CAACG,UADxB,CAEdC,CAAY,CAAGH,CAAa,CAACd,OAAd,CAAsBC,QAFvB,CAIdiB,CAAQ,CAAG,KAAK5B,SAAL,CAAe6B,aAAf,CAA6B,0BAA7B,CAJG,CAKpBD,CAAQ,CAACE,SAAT,CAAqB,KAAKC,UAAL,CAAgBJ,CAAhB,EAA8BK,WACtD,C,qDAEe,YAEZ,KAAKhC,SAAL,CAAeQ,gBAAf,CAAgC,kBAAhC,EACKS,OADL,CACa,SAACgB,CAAD,CAAU,CACfA,CAAI,CAACd,gBAAL,CAAsB,OAAtB,CAA+B,CAAI,CAACe,eAAL,CAAqBb,IAArB,CAA0B,CAA1B,CAA/B,CACH,CAHL,EAMA,KAAKrB,SAAL,CAAeQ,gBAAf,CAAgC,oBAAhC,EACKS,OADL,CACa,SAACgB,CAAD,CAAU,CACfA,CAAI,CAACd,gBAAL,CAAsB,OAAtB,CAA+B,iBAAM,CAAA,CAAI,CAACgB,IAAL,CAAU,YAAV,CAAN,CAA/B,CACH,CAHL,EAIA,KAAKnC,SAAL,CAAeQ,gBAAf,CAAgC,yBAAhC,EACKS,OADL,CACa,SAACgB,CAAD,CAAU,CACfA,CAAI,CAACd,gBAAL,CAAsB,OAAtB,CAA+B,iBAAM,CAAA,CAAI,CAACgB,IAAL,CAAU,iBAAV,CAAN,CAA/B,CACH,CAHL,EAMA,KAAKnC,SAAL,CAAeQ,gBAAf,CAAgC,gBAAhC,EACKS,OADL,CACa,SAACgB,CAAD,CAAU,CACfA,CAAI,CAACd,gBAAL,CAAsB,OAAtB,CAA+B,iBAAM,CAAA,CAAI,CAACgB,IAAL,CAAU,QAAV,CAAN,CAA/B,CACH,CAHL,CAIH,C,yDAEiB,IACRC,CAAAA,CAAgB,CAAG,KAAK/B,aAAL,CAAmB,oBAAnB,EAAyCJ,SADpD,CAERoC,CAAiB,CAAG,KAAKhC,aAAL,CAAmB,qBAAnB,EAA0CJ,SAFtD,CAId,GAAImC,CAAgB,CAACE,QAAjB,CAA0B,WAA1B,CAAJ,CAA4C,CACxCF,CAAgB,CAACjC,MAAjB,CAAwB,WAAxB,EACAkC,CAAiB,CAACnC,GAAlB,CAAsB,WAAtB,CACH,CAHD,IAGO,CACHkC,CAAgB,CAAClC,GAAjB,CAAqB,WAArB,EACAmC,CAAiB,CAAClC,MAAlB,CAAyB,WAAzB,CACH,CACJ,C,oDAQaoC,C,CAAW,CACrB,GAAMN,CAAAA,CAAI,CAAG,KAAKjC,SAAL,CAAe6B,aAAf,YAAiCU,CAAjC,iBAAb,CACA,GAAI,CAACN,CAAL,CAAW,CACP,KAAM,IAAIO,CAAAA,KAAJ,CAAU,kCAAoCD,CAApC,CAAgD,GAA1D,CACT,CACD,MAAON,CAAAA,CACV,C,cA/FmCQ,S","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Cookie consent policy\n *\n * Derived from https://github.com/klaxit/cookie-consent\n * version 0.3.4\n *\n * @module    local_gprd_plus/cookie\n * @class     Cookie\n * @package   local_gprd_plus\n * @copyright 2021 - CALL Learning - Laurent David <laurent@call-learning.fr>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport Observable from \"./observable\";\n\n/**\n * Class managing the consent box.\n */\nexport default class ConsentBox extends Observable {\n    constructor(options = {}) {\n        super();\n\n        this.options = options;\n        this._setUp();\n    }\n\n    open() {\n        this.container.classList.add(\"displayed\");\n    }\n\n    close() {\n        this.container.classList.remove(\"displayed\");\n    }\n\n    selectedCategories() {\n        const categoriesElem = this._firstByClass(\"cc-categories\");\n        const selectedCategories = [];\n        for (let catElem in categoriesElem.querySelectorAll(\"[data-category]\")) {\n            const catKey = catElem.dataset.category;\n            if (catElem.getAttribute('aria-checked') === 'true') {\n                selectedCategories.push(catKey);\n            }\n        }\n        return selectedCategories;\n    }\n\n    _setUp() {\n        // Build container & content\n        this.container = document.getElementById(this.options.containerId);\n\n        this.container.querySelectorAll('.cc-categories.cc-checkboxes [role=\"checkbox\"]').forEach((element) => {\n            element.addEventListener(\"click\", this._categoryClicked.bind(this));\n        });\n        this._setupButtons();\n    }\n\n    _categoryClicked(event) {\n        const targetElement = event.target || event.srcElement;\n        const targetCatKey = targetElement.dataset.category;\n\n        const descElem = this.container.querySelector(\".cc-category-description\");\n        descElem.innerHTML = this.categories[targetCatKey].description;\n    }\n\n    _setupButtons() {\n        // Settings buttons\n        this.container.querySelectorAll(\".cc-btn-settings\")\n            .forEach((elem) => {\n                elem.addEventListener(\"click\", this._toggleSettings.bind(this));\n            });\n\n        // Accept buttons\n        this.container.querySelectorAll(\".cc-btn-accept-all\")\n            .forEach((elem) => {\n                elem.addEventListener(\"click\", () => this.emit(\"accept-all\"));\n            });\n        this.container.querySelectorAll(\".cc-btn-accept-selected\")\n            .forEach((elem) => {\n                elem.addEventListener(\"click\", () => this.emit(\"accept-selected\"));\n            });\n\n        // Reject buttons\n        this.container.querySelectorAll(\".cc-btn-reject\")\n            .forEach((elem) => {\n                elem.addEventListener(\"click\", () => this.emit(\"reject\"));\n            });\n    }\n\n    _toggleSettings() {\n        const landingClassList = this._firstByClass(\"cc-section-landing\").classList;\n        const settingsClassList = this._firstByClass(\"cc-section-settings\").classList;\n\n        if (landingClassList.contains(\"cc-hidden\")) {\n            landingClassList.remove(\"cc-hidden\");\n            settingsClassList.add(\"cc-hidden\");\n        } else {\n            landingClassList.add(\"cc-hidden\");\n            settingsClassList.remove(\"cc-hidden\");\n        }\n    }\n\n    /**\n     * Get the first element matching this class\n     * @param className\n     * @returns {Element}\n     * @private\n     */\n    _firstByClass(className) {\n        const elem = this.container.querySelector(`.${className}:first-child`);\n        if (!elem) {\n            throw new Error(\"Cannot find elements for class \" + className + \".\");\n        }\n        return elem;\n    }\n\n}\n"],"file":"consent-box.min.js"}