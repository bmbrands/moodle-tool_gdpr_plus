function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("tool_gdpr_plus/policies-consent-manager",["exports","./repository","core/notification"],(function(_exports,Repository,_notification){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,Repository=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Repository);var _excluded=["containerId"];function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _objectWithoutProperties(source,excluded){if(null==source)return{};var key,i,target=function(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}(source,excluded);if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++)key=sourceSymbolKeys[i],excluded.indexOf(key)>=0||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(target,property,receiver){var base=_superPropBase(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(arguments.length<3?target:receiver):desc.value}},_get.apply(this,arguments)}function _superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=_getPrototypeOf(object)););return object}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}var DEFAULT_SETTINGS={},PoliciesConsentManager=function(){function PoliciesConsentManager(){var _this=this,alloptions=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,PoliciesConsentManager);var containerId=alloptions.containerId,otheroptions=_objectWithoutProperties(alloptions,_excluded);this.options=Object.assign(DEFAULT_SETTINGS,otheroptions),this.container=document.getElementById(containerId),this.container.querySelectorAll(".tool_gdpr_plus_action").forEach((function(element){var action=element.dataset.action,ACTION_DISPATCHER={"accept-selected":_this.__acceptSelected,"reject-nonessential":_this.__rejectNonEssential,"accept-all":_this.__acceptAll};element.addEventListener("click",ACTION_DISPATCHER[action].bind(_this))})),this.options.policyAgreed||this.open();var showpopup=this.container.querySelector(".show-popup");showpopup.addEventListener("click",this.open.bind(this)),this.triggerCurrentPolicyStatus()}var Constructor,protoProps,staticProps;return Constructor=PoliciesConsentManager,(protoProps=[{key:"open",value:function(){this.container.querySelector(".policy-container").classList.add("displayed")}},{key:"close",value:function(){this.container.querySelector(".policy-container").classList.remove("displayed")}},{key:"emit",value:function(event){_get(_getPrototypeOf(PoliciesConsentManager.prototype),"emit",this).call(this,event,this)}},{key:"triggerCurrentPolicyStatus",value:function(){var policiesAcceptances=this.__getPoliciesAcceptance(!1,!1);document.dispatchEvent(new CustomEvent("grpd_policies_current_status",{detail:policiesAcceptances}))}},{key:"__getPoliciesAcceptance",value:function(rejectNonMandatory,forceAcceptance){var policyAcceptance=[];return this.container.querySelectorAll(".policies-settings-container input.policy-checkbox").forEach((function(policyElement){var policyVersionKey=policyElement.dataset.id,mandatoryPolicy="1"===policyElement.dataset.mandatory,accepted=mandatoryPolicy||policyElement.checked;rejectNonMandatory&&!mandatoryPolicy&&(accepted=!1);var acceptance={policyversionid:policyVersionKey,accepted:accepted=accepted||forceAcceptance};policyAcceptance.push(acceptance)})),policyAcceptance}},{key:"__acceptSelected",value:function(){var policiesAcceptances=this.__getPoliciesAcceptance(!1,!1);this.__acceptPolicies(policiesAcceptances)}},{key:"__rejectNonEssential",value:function(){var policiesAcceptances=this.__getPoliciesAcceptance(!0,!1);this.__acceptPolicies(policiesAcceptances)}},{key:"__acceptAll",value:function(){var policiesAcceptances=this.__getPoliciesAcceptance(!1,!0);this.__acceptPolicies(policiesAcceptances)}},{key:"__acceptPolicies",value:function(policiesAcceptances){this.__setRemotePolicyAcceptance(policiesAcceptances),document.dispatchEvent(new CustomEvent("grpd_policies_accepted",{detail:policiesAcceptances})),this.__resetPolicyUI(policiesAcceptances),this.close()}},{key:"__setRemotePolicyAcceptance",value:function(policiesAcceptances){Repository.acceptPolicies(policiesAcceptances).catch(_notification.exception)}},{key:"__resetPolicyUI",value:function(policiesAcceptances){this.container.querySelectorAll(".policies-settings-container input.policy-checkbox").forEach((function(policyElement){var policyAcceptanceFound=policiesAcceptances&&policiesAcceptances.find((function(elem){return elem.policyid==policyElement.dataset.id}));policyAcceptanceFound&&(policyElement.value=policyElement.checked=policyAcceptanceFound.accepted)}))}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),PoliciesConsentManager}();return _exports.default=PoliciesConsentManager,_exports.default}));

//# sourceMappingURL=policies-consent-manager.min.js.map